# eCitizen Kenya API Service

For Support and Integration You can Email me
<p>Email: jesse.kariuki@softwareske.com</p><br>
<p> WhatsApp: https://wa.me/254700099269</p><br>

This Repository offers an insight into eCitizen Payments and how to Integrate eCitizen Payments API to your Website or ERP system. The Target audience of this Repository are Developers who wish to consume or rather get an indepth understanding of how the Operations of the eCitizen Payment Gateway Works.
<p> eCitizen is government service with Over 16,000 Government services now available from 100+ Ministries, Counties, Departments and Agencies. By bringing closer to your doorstep the accessibility of Government Services Seamlessly and Securely.
  
<li> Immigration Services </li>
<li> County Services  </li>
<li> Civil Registration Services</li>
<li> Tourism Services </li>
<li> Renewal of Driving License (More Common)</li>
<br>
But how does eCitizen Work from behind the scenes. 
</p>
<strong> The API Can be Grouped into 3 Modules </strong>

<ol>
<li> Generate Secure Hash </li>
<li> Payment Initiation Request</li>
<li> Payment Verification Request </li>
</ol>

<h1> Generate Secure Hash </h1>
<p> The workings of this module is to generate a Secure Hash that has to be passed when requesting the eCitizen Iframe. This Hash is generated and passed as part of the request that seeks to confirm that the request originated from a valid user who is recognized by the eCitizen API Credentials Service.
</p>

<p>To Generate the Secure Hash You need the following;
<br>
<strong>api_client_key</strong> - This value is assigned to you by the eCitizen Team and is Unique for Every Client <br>
<strong>api_client_id</strong> - This value is assigned to you by the eCitizen Team and is unique for every Client <br>
<strong>ref_no</strong> - This is a unique value that is generated by the Developer to present uniqueness of a Transaction. We can call it a Unique Transaction Ref</p>

<h3> Generating the Secure Hash</h3>
To arrive at the Secure Hash you need to compute a cryptographic hash of a string that contains the api_client_id and the ref_no using the HMAC (Hash-based Message Authentication Code) mechanism with the SHA-256 algorithm.

```php
public function generateSecureHashEcitizen($api_client_id,$ref_no,$api_client_key,$api_client_key){

    $datastring     = $api_client_id.$ref_no;
    //Sign the payload with the api_client_key to arrive at the secure_hash
    $hash           = hash_hmac("sha256",$datastring,$api_client_key'));
    //encode the Secure binary hash with base64
    $secure_hash    = base64_encode($hash);

    return $secure_hash;

}
```
The Final Secure Hash looks like this
<code>
MDY5YTM0NDBlZjAwYTExYjQyODE1ZTE2ZTZiNjVjYWViNzRlNjU3ZTNjZDc4ZTRkMzMwOGQyZjQ5ODA2MjU3OA==
</code>

<h3>Payment Initiation Request - POST </h3>
  Production URL - https://payments.ecitizen.go.ke/PaymentAPI/iframev2.1.php <br>
  Sandbox URL    - https://test.pesaflow.com/PaymentAPI/iframev2.1.php

<p>To initiate an iFrame Request, You need to pass the Following Parameters to the </p>



